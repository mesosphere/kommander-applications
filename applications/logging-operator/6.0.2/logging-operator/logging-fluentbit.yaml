apiVersion: logging.banzaicloud.io/v1beta1
kind: FluentbitAgent
metadata:
  name: logging-fluentbit
  namespace: ${releaseNamespace}
spec:
  fluentbitConfigName: fluentbit-config
  daemonSet:
    image:
      repository: ghcr.io/mesosphere/dkp-container-images/docker.io/fluent/fluent-bit
      tag: 3.2.5-d2iq.0
    priorityClassName: dkp-critical-priority
    tolerations:
      - operator: Exists
        effect: NoSchedule
      - operator: Exists
        effect: NoExecute
      - operator: Exists
        key: CriticalAddonsOnly
    resources:
      limits:
        memory: 750Mi
      requests:
        cpu: 350m
        memory: 350Mi
    positiondb:
      hostPath:
        path: /var/log/tail-db
        type: DirectoryOrCreate
    metrics:
      port: 2020
      path: /api/v1/metrics/prometheus
      prometheusAnnotations: true
    annotations:
      secret.reloader.stakater.com/reload: logging-operator-logging-fluentbit-tls
