apiVersion: logging.banzaicloud.io/v1beta1
kind: FluentbitAgent
metadata:
  name: default
  namespace: ${releaseNamespace}
spec:
  image:
    repository: ghcr.io/mesosphere/dkp-container-images/docker.io/fluent/fluent-bit
    tag: 3.2.5-d2iq.0
  podPriorityClassName: dkp-critical-priority
  resources:
    limits:
      memory: 750Mi
    requests:
      cpu: 350m
      memory: 350Mi
  tolerations:
    - operator: Exists
      effect: NoSchedule
    - operator: Exists
      effect: NoExecute
    - operator: Exists
      key: CriticalAddonsOnly
  metrics:
    port: 2020
    path: /api/v1/metrics/prometheus
    prometheusAnnotations: true
  inputTail:
    path: /var/log/containers/*.log
    tag: kubernetes.*
    parser: cri
    db: /tail-db/kubernetes.db
    skip_long_lines: On
    refresh_interval: "5"
    rotate_wait: "5"
    mem_buf_limit: 5MB
  filterKubernetes:
    match: kubernetes.*
    kube_tag_prefix: kubernetes.var.log.containers
    merge_log: On
    labels: On
    annotations: On
    buffer_size: "0"
    kube_url: https://kubernetes.default.svc:443
    kube_ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt
    kube_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token
    tls_verify: On
    k8s_logging_parser: Off
    k8s_logging_exclude: Off
  outputForward:
    match: "*"
    host: fluentd.logging.svc
    port: 24240
    retry_limit: "5"
  positiondb:
    hostPath:
      path: /var/log/tail-db
      type: DirectoryOrCreate
  daemonsetAnnotations:
    secret.reloader.stakater.com/reload: logging-operator-logging-fluentbit-tls
