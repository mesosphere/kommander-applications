apiVersion: v1
kind: ConfigMap
metadata:
  # we don't deploy appD controller thus this is a quick way to get override take effect for workload cluster
  name: kube-prometheus-stack-mgmt-overrides
  namespace: ${namespace}
data:
  values.yaml: |
    ---
    prometheus:
      service:
        type: NodePort
        additionalPorts:
          # Expose Thanos sidecar gRPC port for remote querying
          - name: grpc
            port: 10901
            targetPort: grpc
            nodePort: 30901
      prometheusSpec:
        # Ensure Thanos sidecar is enabled
        thanos:
          objectStorageConfig: {}
        # Override storage to use smaller PVC (1Gi) for Kind cluster testing
        storageSpec:
          volumeClaimTemplate:
            metadata:
              name: db
            spec:
              accessModes: ["ReadWriteOnce"]
              resources:
                requests:
                  storage: 1Gi
    grafana:
      persistence:
        enabled: false
    mesosphereResources:
      hooks:
        kubectlImage: bitnamilegacy/kubectl:1.31.4
