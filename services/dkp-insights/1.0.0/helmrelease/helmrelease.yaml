apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: dkp-insights
  namespace: ${releaseNamespace}
spec:
  chart:
    spec:
      chart: dkp-insights
      sourceRef:
        kind: HelmRepository
        name: mesosphere.github.io-dkp-insights-charts-attached
        namespace: kommander-flux
      version: v1.0.0-dev.1
  install:
    remediation:
      retries: 30
  interval: 15s
  releaseName: dkp-insights
  targetNamespace: ${releaseNamespace}
  upgrade:
    remediation:
      retries: 30
      # After the database migration has happened, the previous version of
      # Insights will no longer work. Hence, the default `rollback` strategy
      # can be worse than no remediation at all.
      # On the other hand, we go to significant lengths to ensure
      # that Insights work after being uninstalled and reinstalled again
      # using previously persisted data (note that uninstall does not delete
      # corresponding persistent volumes).
      strategy: uninstall
  valuesFrom:
    - kind: ConfigMap
      name: dkp-insights-1.0.0-dev.1-d2iq-defaults
