
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: thanos-12.4.3-d2iq-defaults
  namespace: ${releaseNamespace}
data:
  values.yaml: |
    ---
    storegateway:
      enabled: false
    compactor:
      enabled: false
    bucketweb:
      enabled: false
    ruler:
      enabled: false
    receive:
      enabled: false
    receiveDistributor:
      enabled: false
    query:
      # Enable DNS discovery for stores
      dnsDiscovery:
        enabled: false
        # Enable DNS discovery for sidecars (this is for the chart built-in sidecar service)
        sidecarsService: false
      # Addresses of statically configured store API servers (repeatable).
      stores: []
      # Names of configmap that contain addresses of store API servers, used for file service discovery.
      existingSDConfigmap: kommander-thanos-query-stores
      # Add extra arguments to the compact service
      extraArgs:
      # Refresh interval to re-read file SD files. It is used as a resync fallback.
      - "--store.sd-interval=5m"
      # Name of HTTP request header used for dynamic prefixing of UI links and redirects.
      - "--web.prefix-header=X-Forwarded-Prefix"
      service:
        ports:
          http: 10902
      serviceGrpc:
        ports:
          grpc: 10901
      grpc:
        client:
          tls:
            enabled: true
            serverName: server.thanos.localhost.localdomain
            existingSecret:
              name: kommander-thanos-client-tls
      commonAnnotations:
        secret.reloader.stakater.com/reload: kommander-thanos-client-tls
      # TODO: make an upstream change to add a change to so that this label will only be applied to service
      commonLabels:
        servicemonitor.kommander.mesosphere.io/path: "metrics"
      ingress:
        enabled: true
        annotations:
          kubernetes.io/ingress.class: kommander-traefik
          traefik.ingress.kubernetes.io/router.tls: "true"
          traefik.ingress.kubernetes.io/router.middlewares: "${workspaceNamespace}-stripprefixes@kubernetescrd,${workspaceNamespace}-forwardauth@kubernetescrd"
        path: "/dkp/kommander/monitoring/query"
        hostname: ""
        extraHosts: []
        tls: []
